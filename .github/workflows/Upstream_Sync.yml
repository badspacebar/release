name: 'ä¸Šæ¸¸è‡ªåŠ¨åŒæ­¥ ğŸ”„'

on:
  schedule:
    - cron:  '*/30 * * * *'

  workflow_dispatch:

jobs:
  sync_latest_from_upstream:
    runs-on: ubuntu-latest
    name: ä»ä¸Šæ¸¸ä»“åº“åŒæ­¥æœ€æ–°æäº¤ ğŸš€

    steps:
    # ç¬¬1æ­¥: æ ‡å‡†çš„ä»£ç æ£€å‡º
    - name: æ£€å‡ºç›®æ ‡ä»“åº“ ğŸ“¦
      uses: actions/checkout@v3
      with:
        ref: master
        persist-credentials: false

    # ç¬¬2æ­¥: åŒæ­¥ä¸Šæ¸¸çš„æ”¹å˜
    - name: åŒæ­¥ä¸Šæ¸¸æ›´æ”¹ ğŸ”„
      id: sync
      uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
      with:
        target_sync_branch: master
        target_repo_token: ${{ secrets.GITHUB_TOKEN }}
        upstream_sync_branch: master
        upstream_sync_repo: badspacebar/release
        test_mode: true
      
    # ç¬¬3æ­¥: åŸºäºåŒæ­¥è¾“å‡ºæ˜¾ç¤ºæ¶ˆæ¯
    - name: å‘ç°æ–°çš„æäº¤ ğŸ†•
      if: steps.sync.outputs.has_new_commits == 'true'
      run: echo "ğŸ‰ æœ‰æ–°çš„æäº¤éœ€è¦åŒæ­¥ã€‚"
    
    - name: æ²¡æœ‰æ–°çš„æäº¤ â„¹ï¸
      if: steps.sync.outputs.has_new_commits == 'false'
      run: echo "â„¹ï¸ æ²¡æœ‰æ–°çš„æäº¤ã€‚"
      
    - name: æ˜¾ç¤º 'has_new_commits' çš„å€¼ ğŸ”
      run: echo ${{ steps.sync.outputs.has_new_commits }}

    - name: è§¦å‘ GitLab_SyncğŸ”„ å·¥ä½œæµ
      run: |
        curl -X POST -H "Authorization: token ${{ secrets.API_TOKEN }}" \
        -H "Accept: application/vnd.github.v3+json" \
        https://api.github.com/repos/${{ github.repository }}/actions/workflows/GitLab_Sync.yml/dispatches \
        -d '{"ref":"master"}'

