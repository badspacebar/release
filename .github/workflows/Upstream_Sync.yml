name: '自动同步 🔄'

on:
  schedule:
    - cron:  '*/15 * * * *'

  workflow_dispatch:

jobs:
  sync_latest_from_upstream:
    runs-on: ubuntu-latest
    name: Sync latest commits from upstream repo 🚀

    steps:
    # 第1步: 标准的代码检出
    - name: Checkout target repo 📦
      uses: actions/checkout@v3
      with:
        ref: master
        persist-credentials: false

    # 第2步: 同步上游的改变
    - name: Sync upstream changes 🔄
      id: sync
      uses: aormsby/Fork-Sync-With-Upstream-action@v3.4
      with:
        target_sync_branch: master
        target_repo_token: ${{ secrets.GITHUB_TOKEN }}
        upstream_sync_branch: master
        upstream_sync_repo: badspacebar/release
        test_mode: false
      
    # 第3步: 基于同步输出显示消息
    - name: New commits found 🆕
      if: steps.sync.outputs.has_new_commits == 'true'
      run: echo "🎉 有新的提交需要同步。"
    
    - name: No new commits ℹ️
      if: steps.sync.outputs.has_new_commits == 'false'
      run: echo "ℹ️ 没有新的提交。"
      
    - name: 显示 'has_new_commits' 的值 🔍
      run: echo ${{ steps.sync.outputs.has_new_commits }}
